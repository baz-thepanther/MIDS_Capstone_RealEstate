from urllib2 import Request, urlopen, URLError
from xml.etree import ElementTree
import csv

zip = (94010,94018,94019,94020,94021,94022,94027,94030,94037,94038,94041,94043,94044,94061,94063,94066,94070,94074,94085,94086,94102,94103,94107,94114,94116,94117,94122,94124,94127,94128,94132,94158,94301,94304,94305,94306,94401,94501,94502,94505,94506,94508,94509,94513,94514,94515,94517,94518,94519,94520,94523,94526,94527,94528,94531,94536,94538,94541,94544,94545,94548,94550,94551,94555,94558,94559,94560,94561,94562,94566,94567,94569,94573,94574,94576,94577,94579,94580,94581,94587,94588,94599,94603,94607,94612,94614,94617,94621,94662,94703,94704,94708,94709,94720,94804,94805,94901,94922,94923,94929,94931,94939,94951,94954,94957,94960,95001,95005,95007,95008,95010,95018,95019,95020,95021,95023,95024,95030,95032,95033,95037,95038,95041,95045,95046,95050,95052,95053,95062,95063,95065,95066,95073,95075,95077,95110,95112,95121,95124,95135,95138,95148,95154,95206,95207,95213,95215,95231,95240,95241,95242,95253,95258,95267,95269,95297,95304,95336,95376,95378,95401,95402,95403,95404,95405,95406,95419,95421,95430,95431,95433,95436,95439,95441,95444,95448,95450,95465,95471,95472,95473,95486,95487,95492)

api = 'APIKeyHere'

overallSchoolDict = {}
for i in zip:
  url_str = 'http://api.greatschools.org/schools/nearby?key=' + str(api) + '&state=CA&radius=10&zip=' + str(i)
  request = Request(url_str)
  response = urlopen(request)
  output = response.read()
  tree = ElementTree.fromstring(output)
  for school in tree:
    schoolDict = {}
    schoolDict['gsId'] = school.find('gsId').text
    schoolDict['name'] = school.find('name').text
    schoolDict['gradeRange'] = school.find('gradeRange').text
    schoolDict['type'] = school.find('type').text
    schoolDict['address'] = school.find('address').text
    overallSchoolDict[school.find('name').text] = schoolDict
  print i


print len(overallSchoolDict.keys())
#2886

for key in overallSchoolDict.keys():
  zipcode = overallSchoolDict[key]['address'][-5:]
  print overallSchoolDict[key]['gsId'] + ',' + overallSchoolDict[key]['name'] + ',' + overallSchoolDict[key]['gradeRange'] + ',' + overallSchoolDict[key]['type'] + ',' + zipcode



gsid = (1,10,100,101,102,103,104,105,106,107,108,10862,10863,10864,10865,10866,10867,10884,10886,10887,10888,10889,109,10985,10987,10988,11002,11004,11005,11077,111,11135,11141,11145,11149,11151,11155,11156,11157,11158,11162,11163,11164,11165,11166,11181,11182,11184,112,113,114,115,116,11682,11683,11684,11687,11688,11692,11696,11697,117,11755,11773,118,11846,11847,11848,11850,11852,11853,11860,11864,11865,11866,11871,11872,11882,11883,11885,119,11904,11905,11911,11912,11913,11914,11922,11925,11927,12,120,12053,12057,12065,12070,12071,12072,12074,12088,12098,121,12178,122,12232,12237,12248,12283,12297,12314,12350,12351,12352,12354,12369,12373,12374,124,12420,12431,12438,12439,12447,12456,12463,12495,12496,125,12505,12506,12508,12518,12522,12536,12547,12550,12552,12557,12571,12572,12573,12576,12589,12602,12604,12607,12608,12620,12626,12629,12647,127,129,130,132,133,135,136,13634,13639,13659,13665,13671,13677,137,13709,13752,13755,13785,13795,138,13801,13804,13805,13851,13873,13876,13880,139,13917,13918,13919,13927,13945,13954,13980,13982,13986,13988,13990,14,140,14029,14035,14052,14058,14067,14068,14076,14089,14103,14122,14140,14144,14156,14158,14161,14162,14176,14189,14207,14225,14244,14278,14279,14282,143,14302,14312,14317,14321,14328,14333,14359,14376,14387,14397,14398,144,14435,14471,14481,14486,14496,145,14534,14568,14597,146,14606,14610,14616,14670,14680,14682,14687,147,14717,14738,14742,14760,14766,14794,148,14845,14850,14852,14855,149,14959,14967,14999,15,15000,15005,15008,15009,15011,15012,15015,15024,15025,15026,15027,15028,15029,15030,15031,15032,15037,15038,15064,15065,151,152,153,154,156,157,158,159,160,161,162,164,168,16833,16834,16835,16839,16863,169,16904,16936,16937,16956,16965,16966,16967,16978,16983,16987,17,170,17000,17002,17004,17032,17037,17040,17042,17043,17059,17060,17091,17092,171,17101,17105,17107,17110,17111,17115,17120,172,173,174,17434,17450,17490,175,17517,17559,17560,17572,17582,176,17622,17625,17626,17629,17634,17637,17651,17658,17666,17671,17672,17689,17704,17717,17720,178,179,180,181,182,183,184,186,187,188,19,191,194,195,199,2,20,200,202,203,207,208,209,21,210,212,216,217,219,22,221,222,224,225,228,229,23,234,236,237,238,239,242,243,244,245,24643,24644,24656,24662,24683,24685,247,24710,24712,24717,248,24800,24810,24825,24836,249,25,250,25000,25008,25011,25018,25045,25046,25079,25096,251,25123,25171,25182,25190,252,25217,25235,25236,25247,253,25330,25336,25378,25380,25383,254,25402,25407,25432,25448,25455,255,25698,25700,25805,25818,259,26,260,261,262,264,26494,26507,26533,26550,26552,26585,26589,26597,269,26955,27,272,27293,273,274,275,277,278,279,280,281,283,284,285,286,288,289,291,294,300,303,304,305,306,307,308,30824,30835,30836,30837,30838,3085,3087,3088,30880,309,3090,3091,30940,30950,30952,30954,30955,30965,30973,30974,30976,30983,31,31070,31076,31087,31093,311,31105,31111,31142,31143,31145,31153,31155,31170,31176,31185,31190,313,314,315,316,31660,31663,31680,317,318,32,3259,3286,3287,3289,3290,3293,3294,33,3324,34,3428,3430,3431,3432,3433,3434,3435,3436,3437,3438,3439,3441,3442,3443,3444,3445,3446,3447,3448,3450,3451,3452,3453,3455,3456,3457,3458,3459,3460,3461,3462,3463,3464,3466,3467,3468,3469,3470,3471,3472,3473,3476,3477,3479,3480,3481,3482,3484,3485,3486,3487,3488,3489,3490,3491,3492,3493,3506,3507,3508,3509,3510,3511,3512,3513,3516,3517,3518,3519,3521,3522,3523,3524,3525,3526,3527,3528,3530,3531,3533,3534,3535,3538,3539,3541,3542,3543,36,37,39,4,40,402,403,405,406,407,408,409,41,411,412,413,415,417,419,42,420,421,422,424,425,426,428,429,43,430,432,433,434,435,436,437,438,439,440,443,444,445,446,448,449,45,450,451,452,4525,453,455,457,458,459,46,4605,4606,4609,461,4610,4611,462,463,464,465,466,4666,467,468,469,47,470,471,472,473,474,476,477,48,481,482,483,484,485,486,487,488,489,49,490,491,492,4926,4927,4928,493,4930,4931,4932,4933,4934,4935,4936,4937,4938,494,4940,4942,4943,4944,4945,4946,495,497,498,499,5,50,500,501,502,503,504,505,506,508,509,51,510,511,512,514,515,516,517,518,519,52,520,521,522,524,525,526,527,528,529,53,530,531,532,533,534,535,536,5367,5368,5369,537,5370,5371,5372,5373,5375,5376,5377,5378,5379,538,5380,5383,5384,5386,5387,5388,5389,539,5391,5392,5393,5394,5395,5396,5397,5399,540,5400,5401,5402,5403,5404,5405,541,5411,542,5423,5424,5425,5426,5427,5428,5429,543,5430,5431,5432,5433,5434,5435,5436,5437,5438,544,5440,5441,5442,5443,5445,5446,5447,5448,5449,545,5450,5451,5452,5453,5455,5456,5457,5458,5459,546,5460,5461,5462,5463,5464,5465,5466,5467,5468,5469,547,5470,5472,5473,5474,5475,5476,5477,5478,5479,548,5480,5481,5482,5484,5485,5486,5487,5488,549,5490,5491,5492,5493,5494,5495,5496,5497,5498,5499,55,550,5500,5501,5502,5503,5504,5505,5506,5508,5509,551,5510,5511,5512,5514,5515,5517,5518,5519,552,5520,5521,5522,5523,5524,5525,5526,5527,5528,5529,553,5530,5531,5533,5535,5536,5538,5539,554,5540,5541,5542,5543,5544,5545,5546,5547,5548,5549,555,5550,5551,5552,5553,5554,5555,5556,5557,5558,556,5560,5561,5562,5563,5565,5567,5569,557,5571,5572,5573,5574,5575,5576,5577,5579,558,5580,5581,5582,5583,5584,5586,5587,5588,5589,559,5590,5591,5592,5593,5594,5595,5596,5597,5599,56,560,5600,5601,5602,5603,5604,5605,5606,5607,5608,5609,561,5610,5611,5612,5613,5614,5615,5617,5618,5619,562,5620,5621,5623,5626,5627,5628,5629,563,5630,5631,5632,5633,5635,5636,5637,5638,5639,5640,5641,5642,5643,5644,5647,5648,5649,565,5651,5653,5654,5655,5656,5657,5661,5662,5664,5666,5667,5668,5669,567,5670,5672,5673,5674,5675,5676,5677,5678,5679,568,5680,5681,5682,5684,5685,5686,5687,5688,5689,569,5692,5693,5694,5695,5696,5697,5698,5699,57,570,5700,5701,5702,5703,5704,5705,5708,5709,571,5710,5712,5713,5714,5715,5717,5718,5719,5724,5725,5726,5727,5729,573,5730,5731,5733,5734,5735,5736,5737,5738,574,5740,5741,5742,5744,5745,5746,5747,5748,5749,575,5750,5753,5754,5755,5756,5758,5759,5760,5761,5764,5766,5767,5768,5769,577,5770,5771,5772,5773,5776,5778,5779,578,5781,5782,5783,5784,579,58,580,582,583,584,585,586,588,589,591,593,595,596,597,598,599,6,60,601,603,604,605,606,607,608,61,610,611,613,614,615,616,617,63,6337,6338,6339,6340,6341,6344,6346,6347,6348,6349,6350,6351,6353,6358,6359,6360,6363,6364,6366,6367,6369,6372,6373,6375,6377,6378,6383,6385,6386,6388,6389,6390,6392,6394,6395,6396,6397,6399,6400,6404,6406,6408,6409,6410,6411,6413,6415,6417,6418,6419,6420,6421,6423,6424,6425,6426,6428,6429,6430,6431,6432,6433,6435,6436,6437,6439,6441,6442,6445,6446,6447,6448,6449,6450,6451,6452,6454,6455,65,6524,6526,6530,6531,6534,6535,6536,6537,6539,6540,6541,6542,6543,6545,6547,6548,6550,6551,6552,6554,6556,6557,6558,6560,6561,6562,6563,6564,6565,6566,6567,6568,6569,6570,6571,6572,6573,6574,6575,6576,6577,6578,6580,6581,6582,6584,6586,6587,6588,6589,6590,6591,6592,6593,6594,6595,6596,6597,6598,6599,66,6600,6601,6602,6603,6604,6605,6606,6608,6609,6610,6611,6612,6613,6615,6616,6617,6618,6619,6620,6621,6622,6623,6624,6625,6626,6630,6632,6633,6634,6635,6636,6637,6638,6641,6642,6644,6645,6646,6647,6648,6649,6650,6651,6652,6653,6654,6655,6656,6658,6659,6660,6662,6663,6664,6666,6667,6668,6669,6670,6671,6672,6674,6675,6676,6677,6678,6681,6682,6699,67,6709,6739,6740,6741,6742,6744,6745,6746,6747,6751,6753,6754,6755,6756,6757,6758,6759,6760,6762,6763,68,6835,6836,6838,6839,6840,6841,6842,6843,6844,6845,6846,6852,6853,6854,6855,6856,6857,6858,6859,6860,6861,6862,6863,6864,6867,6868,6869,6871,6872,6873,6874,6876,6878,6879,6880,6881,6882,6883,6886,6891,6892,6893,6894,6895,6896,6897,6898,6899,69,6900,6901,6903,6904,6905,6906,6907,6908,6909,6910,6911,6912,6914,6917,6918,6921,6922,6923,6924,6926,6928,6929,6932,6933,6935,6937,6938,6940,6942,6943,6946,6950,6951,6953,6954,6955,6956,6957,6958,6959,6960,6961,6962,6963,6964,6965,6967,6969,6970,6971,6973,6974,6975,6976,6977,6978,6979,6980,6981,6982,6983,6984,6987,6988,6989,6990,6991,6993,6994,6995,6996,6997,6999,70,7000,7002,7003,7004,7006,7007,7008,7009,7011,7012,7013,7015,7017,7019,7020,7021,7022,7023,7024,7025,7026,7027,7028,7029,7030,7033,7035,7039,7040,7041,7042,7045,7046,7048,7051,7052,7053,7056,7061,7062,7063,7064,7066,7072,7073,7074,7075,7076,7077,7078,7080,7082,7086,7087,7088,7089,7092,7093,7094,7095,7096,7097,7098,71,7100,7101,7102,7103,7104,7106,7107,7108,7109,7110,7113,7114,7115,7116,7117,7118,7119,7120,7121,7122,7123,7124,7125,7126,7127,7128,7129,7131,7132,7133,7135,7137,7139,7140,7141,7142,7144,7145,7146,7148,72,73,74,76,77,78,79,8,80,81,82,83,84,85,86,87,89,9,91,92,93,94,95,96,97,98,99)


overallSchoolRate = {}

for i in gsid:
  url_str = 'http://api.greatschools.org/schools/CA/' + str(i) + '?key=' + str(api)
  request = Request(url_str)
  response = urlopen(request)
  output = response.read()
  tree = ElementTree.fromstring(output)
  schoolRate = {}
  schoolRate['gsId'] = i
  if tree.find('gsRating') is not None:
    schoolRate['gsRating'] = tree.find('gsRating').text
  else:
    schoolRate['gsRating'] = tree.find('gsRating')
  overallSchoolRate[str(i)] = schoolRate
  print i


for key in overallSchoolRate.keys():
  print str(overallSchoolRate[key]['gsId']) + ',' + str(overallSchoolRate[key]['score']) + ',' + str(overallSchoolRate[key]['year']) + ',' + str(overallSchoolRate[key]['scale'])




for i in gsid:
  url_str = 'http://api.greatschools.org/schools/CA/' + str(i) + '?key=' + str(api)
  request = Request(url_str)
  response = urlopen(request)
  output = response.read()
  tree = ElementTree.fromstring(output)
  school = tree.find('school')
  schoolRate = {}
  schoolRate['gsId'] = i
  schoolRate['name'] = rank.find('name').text
  schoolRate['scale'] = rank.find('scale').text
  schoolRate['year'] = rank.find('year').text
  schoolRate['score'] = rank.find('score').text
  overallSchoolRate[str(i)] = schoolRate
  print i